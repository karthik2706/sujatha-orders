<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <title>Order Management System</title>
    <script src="client.js"></script>

    <style>
        .hide, .hide-2, .hide-cod {
            display: none !important;
        }

        .show, .show-2 , .show-cod{
            display: block !important;
        }
        .modal.show .modal-dialog {
            pointer-events: auto;
        }
        .logo {
          text-align: center;
        }
        .logo img {
          height: 100px;
        }
        #exportOrder {
          border: 1px solid #000;
          padding: 20px;
        }
        #trackingTable_length, #trackingTable_filter, #trackingTable_paginate, #trackingTable_info {
            display: none;
        }
        #orderResults {
            overflow-x: scroll;
        }
    </style>
</head>

<body>
    <div class="container">
        <br>
        <br>
        <div class="logo">
            <h2>Sujatha Gold Covering</h2>
            <h4>Machilipatnam</h4>
        </div>
        <br>
        <br>
        <h2>Customer Tracking Page</h2>
        <br>
    </div>
    <div class="container">
        <!-- Content here -->
        <form id="tracking" action="#">
            <div class="mb-3">
                <label class="form-label"><strong>Enter the mobile given in the Order</strong></label>
                <input autocomplete="off" name="mobile" type="number" class="form-control">
            </div>
            <button class="btn btn-primary findOrders">Find My Orders</button>
            <br><br>
            
            <div id="orderResults" class="hide">
                <strong style="color: green;">Hold the table and swipe left or right to see the full data &lt;--------&gt; </strong>
                <table id="trackingTable" class="table table-striped table-bordered" style="width:100%">

                </table>
            </div>
            <br><br>
        </form>

        <div class="pagevisits">
            <h4>Page Visits</h4>
        </div>
        <!-- hitwebcounter Code START -->
    <!-- <a href="https://www.hitwebcounter.com" target="_blank"> -->
        <img src="https://hitwebcounter.com/counter/counter.php?page=7972079&style=0011&nbdigits=9&type=page&initCount=0" title="Free Counter" Alt="web counter"   border="0" />
    <!-- </a>                            -->
    </div>

   
</div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
        crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
    <script src="moment.min.js"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript" src="//unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->
    <!-- <script src="html2pdf.bundle.js"></script>
    <script src="pincodes.js"></script>
    <script src="custom.js"></script> -->

    <script>
        window.page = location.href;
        $(document).ready(function(){
            //Tracking Code
  var $trackingForm = $("#tracking");
  $(".findOrders").click(function (e) {
    e.preventDefault();
    var mobile = $trackingForm.find("[name=mobile]").val();
    $("#orderResults").removeClass("hide");
    var apiUrl = `/omsServices/getOrdersByMobile/${mobile}`;

    fetch(apiUrl)
      .then((response) => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then((data) => {
        console.log(data);
        ordersData = data;
        // Process the data received from the server (list of orders with the specified mobile number)
        let parseData = [];
        $.each(ordersData, function (key, value) {
          value.id = key;
          parseData.push(value);
        });

        console.log('filteredOrders', parseData)

        if ($.fn.DataTable.isDataTable("#trackingTable")) {
          $("#trackingTable").dataTable().fnDestroy();
        }

        $.each(parseData, function (key, value) {
          this.tracking = this.vendor + "_" + this.tracking;
        });

        $("#trackingTable").DataTable({
          responsive: true,
          data: parseData,
          drawCallback: function () {
            $("#trackingTable tbody")
              .find("tr")
              .each(function () {
                var data = $(this).find("td:last").text();
                var linkEl;
                var details;
                var link;
                var courier = "";
                var tracking = "";
                if (data && data.length) {
                  details = data.split("_");
                  if (details[0] == "1") {
                    courier = "india-post";
                  } else if (details[0] == "2") {
                    courier = "delhivery";
                  } else if (details[0] == "3") {
                    courier = "dtdc";
                  } else if (details[0] == "4") {
                    courier = "xpressbees";
                  }
                  if (details[1] && details[1].trim().length) {
                    tracking = details[1];
                    link =
                      "https://track.aftership.com/trackings?courier=" +
                      courier +
                      "&tracking-numbers=" +
                      tracking;
                  }

                  if (details[0] == "5") {
                    tracking = details[1];
                    link =
                      "https://www.delhivery.com/track/package/" + tracking;
                  }

                  if (link && link.length) {
                    linkEl =
                      'Click here -> <a target="_blank" href="' +
                      link +
                      '">' +
                      tracking +
                      "</a>";
                  } else {
                    if (courier.length) linkEl = "Pending";
                  }
                  $(this).find("td:last").html(linkEl);
                }
              });
          },
          columns: [
            { title: "Name", data: "name" },
            { title: "Mobile", data: "mobile" },
            {
              title: "Tracking",
              data: "tracking",
              render: function (data) {
                return data;
              },
            },
          ],
        });

        // renderOrders("trackingTable", filteredOrders, false);
      });
  })

        })
    </script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous"></script>
    -->

             
</body>

</html>